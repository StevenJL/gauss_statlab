<div class="row-fluid">  
  <div class="span12">
    <form class="form-horizontal">  
      <fieldset>
        <div class="row offset1"><h4>Confidence Interval</h4></div>
        <div class="row offset1" style="padding: 20px; margin-left: 50px; padding-bottom: 30px;" >
          <div class="span10">
            Enter the raw data or summary statistics.
            <span class="stat-label">Instructions</span>
          </div>
          
        </div>   
        <div class="control-group">  
          <label class="control-label" for="textarea">Data Input</label>  
          <div class="controls">  
            <textarea class="input-xlarge" id="textarea" rows="3"></textarea>  
          </div>  
        </div>
        <div class="form-actions">  
          <button type="button" class="btn btn-primary" id="compute-button">Compute</button>  
        </div>  
      </fieldset>  
    </form> 
  </div>
</div>

<div class="leaderboard results">  
  <div class="row-fluid">
    <div class="span4">

    </div>
    <div class="span6 graph">
      
    </div>  
  </div>
</div>


<script>

  $(".leaderboard").hide()
  $("#compute-button").on('click', function(){
    var canvas = $()

    var input_data = $("#textarea").val()

    var draw = function(hist) {
      var canvas = $("<canvas id='myCanvas' width='500' height='300' style='border:1px solid #A9A9F5; border-radius: 1em; background-color: #FAFAFA;'></canvas>")
      $('.graph').append(canvas)
      var ctx = canvas.get(0).getContext("2d")   
      // ctx.translate(0,300)
      // ctx.scale(1,-1)
      ctx.strokeStyle = "#000000";
      // debugger
      var hor_range = hist[hist.length - 1].high - hist[0].low
      var ver_range = 0
      for(i=0; i< hist.length; i++){
        if (hist[i].value > ver_range){
          ver_range = hist[i].value
        }
      }
      // debugger
      var hor_scale = 300.0 / hor_range
      var ver_scale = 200.0 / ver_range
      ctx.font = "bold 12px sans-serif"
      for(i=0; i < hist.length; i++){
        var diff = i * (hist[i].high - hist[i].low)* hor_scale
        ctx.strokeRect(100 + diff, 250 - hist[i].value * ver_scale, (hist[i].high - hist[i].low) * hor_scale, hist[i].value*ver_scale)
        ctx.fillText(hist[i].middle.toFixed(0), 100+diff, 270)
      }
    }

    $.ajax({
      url: '/univariate/compute',
      data: { input_data: input_data },
      success: function(data){
        $("#n").html(data.n)
        $("#min").html(data.min)
        $("#first_qart").html(data.first_quartile.toFixed(3))
        $("#mean").html(data.mean.toFixed(3))
        $("#median").html(data.median.toFixed(3))
        $("#third_qart").html(data.third_quartile.toFixed(3))
        $("#max").html(data.max)
        $("#s").html(data.s.toFixed(3))
        $("#sigma").html(data.sigma.toFixed(3))
        $("#samp_var").html(data.variance_sam.toFixed(3))
        $("#pop_var").html(data.variance_pop.toFixed(3))
        $("#ss").html(data.ss.toFixed(3))
        $("#kurt").html(data.kurtosis.toFixed(3))
        $(".graph").empty()
        draw(data.histogram)
      }
    })
    $(".leaderboard").slideDown()
  })
</script>