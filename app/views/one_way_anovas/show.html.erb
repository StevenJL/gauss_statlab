<div class="leaderboard results">  
  <div class="row-fluid">
    <div class="span12">
      <table>
        <tr><td class="stat-label">F-Statistic:</td><td id="f-stat"></td>
            <td></td>
            <td class="stat-label">P-Value:</td><td id="p-value"></td>
            <td></td>      
            <td class="stat-label">Sum of Squares Total:</td><td id="sst"></tr>
      </table>
    </div>
      <div class="span12 graph"></div>
  </div>
</div>

<div class="form-actions">  
  <button type="button" class="btn btn-primary" id="compute-button">Compute</button>  
</div>
<div class="row-fluid">  
  <div class="span12">
    <form class="form-horizontal">  
      <fieldset>
        <div class="row offset1"><h4>One Way ANOVA</h4></div>
        <div class="row offset1" style="padding: 20px; margin-left: 50px; padding-bottom: 30px;" >
          <div class="span10">
            Enter you data in the fields below.  You can also add groups with the "add group" button.
            <span class="stat-label">Instructions</span>
          </div>  
        </div>
        <div class="control-group">  
          <label class="control-label" for="textarea1">Group 1</label>  
          <div class="controls">  
            <textarea class="input-xlarge" id="textarea1" rows="3">1,2,3,4,5,6</textarea>  
          </div>
        </div>  
        <div class="control-group">
          <label class="control-label" for="textarea2">Group 2</label>
          <div class="controls">  
            <textarea class="input-xlarge" id="textarea2" rows="3">5,6,5,6,7,8,7,6,9</textarea>  
          </div>
        </div>
        <div class="control-group">
          <label class="control-label" for="textarea2">Group 3</label>
          <div class="controls">  
            <textarea class="input-xlarge" id="textarea3" rows="3">5,6,5,6,7,8,7,6,9</textarea>  
          </div>
        </div>        
      </fieldset>
      <div class="form-actions">  
        <button type="button" class="btn btn-primary" id="add-field-button">Add Group</button>  
      </div>
    </form> 
  </div>
</div>
<script>
  $(".leaderboard").hide()
  var index = 4
  $("#add-field-button").on("click",function(){
    $("fieldset").append("<div class='control-group'><label class='control-label' for='textarea2'>Group " + index + "</label><div class='controls'><textarea class='input-xlarge' id='textarea2' rows='3'></textarea></div></div>")
      index += 1    
  })

  $("#compute-button").on("click", function(){

      var datasets = $(".input-xlarge")
      var data_sets_array = []
      for(i=0; i<datasets.length; i++){
        data_sets_array.push([datasets[i].value])
      }
    $.ajax({
      url: '/one_way_anovas/compute',
      data: { data_sets_array: data_sets_array },
      success: function(results){
        var Fstat = results.f
        var pvalue = results.p
        var sst = results.sst
        var data_sets_array = results.data_sets_array

        $("#f-stat").html(Fstat.toFixed(3))
        $("#p-value").html(pvalue.toFixed(3))
        $("#sst").html(sst.toFixed(2))

         
          var margin = {top: 10, right: 50, bottom: 20, left: 50},
              width = 120 - margin.left - margin.right,
              height = 350 - margin.top - margin.bottom;

        var min = results.min
        var max = results.max

          var chart = d3.box()
              .whiskers(iqr(1.5))
              .width(width)
              .height(height);

            chart.domain([1, 9]);

          // debugger

          var svg = d3.select(".graph").selectAll("svg")
              .data(data_sets_array)
            .enter().append("svg")
              .attr("class", "box")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.bottom + margin.top)
            .append("g")
              .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
              .call(chart);

          function iqr(k) {
            return function(d, i) {
              var q1 = d.quartiles[0],
                  q3 = d.quartiles[2],
                  iqr = (q3 - q1) * k,
                  i = -1,
                  j = d.length;
              while (d[++i] < q1 - iqr);
              while (d[--j] > q3 + iqr);
              return [i, j];
            };
          }

        $(".leaderboard").slideDown()
      }
    })
  })
    
</script>